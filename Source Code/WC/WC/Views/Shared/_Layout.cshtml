@using Microsoft.AspNet.Identity
@using WC.Data
@using WC.Models
@{
    var db = new CyberEntities();
    var currentUserId = User.Identity.GetUserId();
    var userInfo = new User();
    var displayName = "";
    var friendList = new List<FriendViewModel>();
    if (!String.IsNullOrEmpty(currentUserId))
    {
        userInfo = db.Users.FirstOrDefault(x => x.UserID.Equals(currentUserId, StringComparison.InvariantCultureIgnoreCase));
        if (userInfo != null)
        {
            displayName = userInfo.FirstName;
            var list = userInfo.FriendLists.First().Friends.Where(x => x.FriendStatus);
            friendList = list.Select(item => new FriendViewModel
            {
                FriendId = item.FriendId,
                Name = item.User.FirstName + " " + item.User.LastName,
                ProfileImgUrl = item.User.Profile_Photo.ProfileImageUrl
            }).ToList();
        }
    }
    var notify = db.Notifications.Where(x => x.UserID == currentUserId && !x.Seen).OrderByDescending(y => y.NotificationDate).ToList();
}
<!DOCTYPE html>
<html class=" js flexbox canvas canvastext webgl no-touch geolocation postmessage websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers applicationcache svg inlinesvg smil svgclippaths">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <!-- Title -->
    <title>@ViewBag.Title</title>

    <meta content="width=device-width, initial-scale=1" name="viewport">
    <meta charset="UTF-8">
    <meta name="description" content="Admin Dashboard Template">
    <meta name="keywords" content="admin,dashboard">
    <meta name="author" content="Steelcoders">

    <!-- Styles -->
    @Styles.Render("~/bundles/Style")
    @Scripts.Render("~/bundles/Theme")
    @Scripts.Render("~/bundles/jquery")
    <script src="~/Content/Script/jquery.nicescroll.min.js"></script>
    <script src="~/Scripts/jquery.signalR-2.2.0.min.js"></script>
    <script src="/signalr/hubs"></script>
    <script src="~/Hubs/cyber-chat.js"></script>
    <script type="text/javascript">
        function showMsg(content) {
            $('#contentModal').append(content);
            $('#msgModal').modal('toggle'); 
        }

        function closeMsg() {
            location.reload();
        }

        function showConfirmMsg(content, url, userid) {
            $('#contentConfirmModal').append(content);
            $('#btnConfirmYes').attr("data-item-url", url);
            $('#btnConfirmYes').attr("data-item-id", userid);
            $('#msgConfirmModal').modal('toggle');
        }

        function closeConfirmMsg(e) {
            var targetId = e.getAttribute("data-item-id");
            var url = e.getAttribute("data-item-url");

            $.post(url, { targetUserId: targetId }, function () {
                location.reload();
            });
        }
    </script>
    <script type="text/javascript">
        $(document).on('click', '.notification-item', function () {
            var notifId = $(this).data("id");
            var linkUrl = $(this).data("href");

            var url = '@Url.Action("SeenNotification", "Post")';

            $.post(url, { "notificationId": notifId },
                function (data) {
                    if (data === "Succeed") {
                        location.href = linkUrl;
                    } else {
                        location.reload();
                    }
                });
        });
    </script>
</head>
<body class="page-header-fixed  pace-done">
<div class="pace  pace-inactive">
    <div class="pace-progress" data-progress-text="100%" data-progress="99" style="transform: translate3d(100%, 0px, 0px);">
        <div class="pace-progress-inner"></div>
    </div>
</div>
<div class="overlay"></div>
<nav class="cbp-spmenu cbp-spmenu-vertical cbp-spmenu-right" id="cbp-spmenu-s1">
    <h3><span class="pull-left">Chat</span><a href="javascript:void(0);" class="pull-right close-chat" id="closeRight"><i class="fa fa-times"></i></a>
    </h3>
    <div class="slimScrollDiv" style="position: relative; overflow: hidden; width: auto; height: 100%;">
        <div class="slimscroll" style="overflow: scroll; width: auto; height: 100%;">
            
            @{
                Html.RenderPartial("FriendListPartial", friendList);
            }

        </div>
        <div class="slimScrollBar" style="width: 7px; position: absolute; top: 0px; opacity: 0.3; display: none; border-radius: 0px; z-index: 99; right: 0px; height: 629px; background: rgb(204, 204, 204);"></div>
        <div class="slimScrollRail" style="width: 7px; height: 100%; position: absolute; top: 0px; display: none; border-radius: 0px; opacity: 0.2; z-index: 90; right: 0px; background: rgb(51, 51, 51);"></div>
    </div>
</nav>
<nav class="cbp-spmenu cbp-spmenu-vertical cbp-spmenu-right" id="cbp-spmenu-s2">
    <h3><span id="chat-box-name" class="pull-left">Sandra Smith</span> <a href="javascript:void(0);" class="pull-right close-chat" id="closeRight2"><i class="fa fa-angle-right"></i></a>
</h3>
    <div class="slimScrollDiv" style="position: relative; overflow: hidden; width: auto; height: 100%;">
        <div id="chat-box-content" class="slimscroll chat" style="overflow: scroll; width: auto; height: 100%;">

        </div>
    </div>
    <div class="slimScrollBar" style="width: 7px; position: absolute; top: 0px; opacity: 0.3; display: none; border-radius: 0px; z-index: 99; right: 0px; height: 629px; background: rgb(204, 204, 204);"></div>
    <div class="slimScrollRail" style="width: 7px; height: 100%; position: absolute; top: 0px; display: none; border-radius: 0px; opacity: 0.2; z-index: 90; right: 0px; background: rgb(51, 51, 51);"></div>

    <div class="chat-write">
        <form class="form-horizontal" action="javascript:void(0);">
            <input type="text" class="form-control" placeholder="Say something" id="chat-box-message" data-item-url="@Url.Action("GetHtmlListChatItemOf")" data-item-fromid="@currentUserId" data-item-toid="">
        </form>
    </div>
</nav>
<div class="menu-wrap">
    <nav class="profile-menu">
        <div class="profile"><img src="@Url.Content(userInfo.Profile_Photo.ProfileImageUrl)" width="60" alt="Profile Image"><span>@userInfo.FirstName @userInfo.LastName</span></div>
        <div class="profile-menu-list">
            <a href="http://lambdathemes.in/admin1/index.html#"><i class="fa fa-star"></i><span>Favorites</span></a>
            <a href="http://lambdathemes.in/admin1/index.html#"><i class="fa fa-bell"></i><span>Alerts</span></a>
            <a href="http://lambdathemes.in/admin1/index.html#"><i class="fa fa-envelope"></i><span>Messages</span></a>
            <a href="http://lambdathemes.in/admin1/index.html#"><i class="fa fa-comment"></i><span>Comments</span></a>
        </div>
    </nav>
    <button class="close-button" id="close-button">Close Menu</button>
</div>
<form class="search-form" action="http://lambdathemes.in/admin1/index.html#" method="GET">
    <div class="input-group">
        <input type="text" name="search" class="form-control search-input" placeholder="Search...">
        <span class="input-group-btn">
                <button class="btn btn-default close-search waves-effect waves-button waves-classic" type="button"><i class="fa fa-times"></i></button>
            </span>
    </div><!-- Input Group -->
</form><!-- Search Form -->
<main class="page-content content-wrap">
<div class="navbar">
    <div class="navbar-inner">
        <div class="sidebar-pusher">
            <a href="javascript:void(0);" class="waves-effect waves-button waves-classic push-sidebar">
                <i class="fa fa-bars"></i>
            </a>
        </div>
        <div class="logo-box">
            <a href="@Url.Action("Newsfeed", "Home")" class="logo-text"><span>Cyber</span></a>
        </div><!-- Logo Box -->
        <div class="search-button">
            <a href="javascript:void(0);" class="waves-effect waves-button waves-classic show-search"><i class="fa fa-search"></i></a>
        </div>
        <div class="topmenu-outer">
            <div class="top-menu">
                <ul class="nav navbar-nav navbar-left">
                    <li>
                        <a href="javascript:void(0);" class="waves-effect waves-button waves-classic sidebar-toggle"><i class="fa fa-bars"></i></a>
                    </li>
                    <li>
                        <a href="#cd-nav" class="waves-effect waves-button waves-classic cd-nav-trigger"><i class="fa fa-diamond"></i></a>
                    </li>
                    <li>
                        <a href="javascript:void(0);" class="waves-effect waves-button waves-classic toggle-fullscreen"><i class="fa fa-expand"></i></a>
                    </li>
                </ul>
                @using (Html.BeginForm("LogOff", "Account", FormMethod.Post, new {id = "logoutForm"}))
                {
                    @Html.AntiForgeryToken()
                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="javascript:void(0);" class="waves-effect waves-button waves-classic show-search"><i class="fa fa-search"></i></a>
                        </li>
                        <li class="dropdown">
                            <a href="http://lambdathemes.in/admin1/index.html#" class="dropdown-toggle waves-effect waves-button waves-classic" data-toggle="dropdown"><i class="fa fa-envelope"></i><span class="badge badge-success pull-right">4</span></a>
                            <ul class="dropdown-menu title-caret dropdown-lg" role="menu">
                                <li>
                                    <p class="drop-title">You have 4 new messages !</p>
                                </li>
                                <div class="slimScrollDiv" style="position: relative; overflow: hidden; width: auto; height: 100%;">
                                    <li class="dropdown-menu-list slimscroll messages" style="overflow: hidden; width: auto; height: 100%;">
                                        <ul class="list-unstyled">
                                            <li>
                                                <a href="http://lambdathemes.in/admin1/index.html#">
                                                    <div class="msg-img">
                                                        <div class="online on"></div><img class="img-circle" src="~/Content/Images/avatar2.png" alt="">
                                                    </div>
                                                    <p class="msg-name">Sandra Smith</p>
                                                    <p class="msg-text">Hey ! I'm working on your project</p>
                                                    <p class="msg-time">3 minutes ago</p>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="http://lambdathemes.in/admin1/index.html#">
                                                    <div class="msg-img">
                                                        <div class="online off"></div><img class="img-circle" src="~/Content/Images/avatar4.png" alt="">
                                                    </div>
                                                    <p class="msg-name">Amily Lee</p>
                                                    <p class="msg-text">Hi David !</p>
                                                    <p class="msg-time">8 minutes ago</p>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="http://lambdathemes.in/admin1/index.html#">
                                                    <div class="msg-img">
                                                        <div class="online off"></div><img class="img-circle" src="~/Content/Images/avatar3.png" alt="">
                                                    </div>
                                                    <p class="msg-name">Christopher Palmer</p>
                                                    <p class="msg-text">See you soon !</p>
                                                    <p class="msg-time">56 minutes ago</p>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="http://lambdathemes.in/admin1/index.html#">
                                                    <div class="msg-img">
                                                        <div class="online on"></div><img class="img-circle" src="~/Content/Images/avatar5.png" alt="">
                                                    </div>
                                                    <p class="msg-name">Nick Doe</p>
                                                    <p class="msg-text">Nice to meet you</p>
                                                    <p class="msg-time">2 hours ago</p>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="http://lambdathemes.in/admin1/index.html#">
                                                    <div class="msg-img">
                                                        <div class="online on"></div><img class="img-circle" src="~/Content/Images/avatar2.png" alt="">
                                                    </div>
                                                    <p class="msg-name">Sandra Smith</p>
                                                    <p class="msg-text">Hey ! I'm working on your project</p>
                                                    <p class="msg-time">5 hours ago</p>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="http://lambdathemes.in/admin1/index.html#">
                                                    <div class="msg-img">
                                                        <div class="online off"></div><img class="img-circle" src="~/Content/Images/avatar4.png" alt="">
                                                    </div>
                                                    <p class="msg-name">Amily Lee</p>
                                                    <p class="msg-text">Hi David !</p>
                                                    <p class="msg-time">9 hours ago</p>
                                                </a>
                                            </li>
                                        </ul>
                                    </li>
                                    <div class="slimScrollBar" style="width: 7px; position: absolute; top: 0px; opacity: 0.3; display: block; border-radius: 0px; z-index: 99; right: 0px; background: rgb(204, 204, 204);"></div>
                                    <div class="slimScrollRail" style="width: 7px; height: 100%; position: absolute; top: 0px; display: none; border-radius: 0px; opacity: 0.2; z-index: 90; right: 0px; background: rgb(51, 51, 51);"></div>
                                </div>
                                <li class="drop-all"><a href="http://lambdathemes.in/admin1/index.html#" class="text-center">All Messages</a></li>
                            </ul>
                        </li>
                        <li id="notify-box" class="dropdown">  
                            @{
                                Html.RenderPartial("NotificationPartial", notify);
                            }
                        </li>
                        <li>
                            <a href="@Url.Action(User.Identity.Name, "Profile")" class="waves-effect waves-button waves-classic">
                                <span class="user-name">@displayName</span>
                                <img class="img-circle avatar" src="@Url.Content(userInfo.Profile_Photo.ProfileImageUrl)" width="40" height="40" alt="">
                            </a>
                        </li>
                        <li>
                            <a href="javascript:document.getElementById('logoutForm').submit()" class="log-out waves-effect waves-button waves-classic">
                                <span><i class="fa fa-sign-out m-r-xs"></i>Log Off</span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="waves-effect waves-button waves-classic" id="showRight">
                                <i class="fa fa-comments"></i>
                            </a>
                        </li>
                    </ul>
                }
                <!-- Nav -->
            </div><!-- Top Menu -->
        </div>
    </div>
</div><!-- Navbar -->
<div class="page-sidebar sidebar visible">
    <div class="slimScrollDiv" style="position: relative; overflow: hidden; width: auto; height: 100%;">
        <div class="page-sidebar-inner slimscroll" style="overflow: hidden; width: auto; height: 100%;">
            <ul class="menu accordion-menu">
                <li><a href="@Url.Action("Newsfeed", "Home")" class="waves-effect waves-button"><span class="menu-icon glyphicon glyphicon-home"></span><p>New Feed</p></a></li>
                <li><a href="@Url.Action(User.Identity.Name, "Profile")" class="waves-effect waves-button"><span class="menu-icon glyphicon glyphicon-user"></span><p>Profile</p></a></li>
                @*<li class="droplink">
                                <a href="http://lambdathemes.in/admin1/index.html#" class="waves-effect waves-button"><span class="menu-icon glyphicon glyphicon-envelope"></span><p>MessageBox</p></a>
                            </li>*@
                <li>
                    <a id="showRight_t2" href="javascript:void(0);" class="waves-effect waves-button"><span class="menu-icon glyphicon glyphicon-envelope"></span><p>Chat</p></a>
                </li>
                <li class="droplink">
                    <a href="http://lambdathemes.in/admin1/index.html#" class="waves-effect waves-button"><span class="menu-icon glyphicon glyphicon-log-in"></span><p>Login</p><span class="arrow"></span></a>
                    <ul class="sub-menu" style="display: none;">
                        <li><a href="http://lambdathemes.in/admin1/login.html">Login Form</a></li>
                        <li><a href="http://lambdathemes.in/admin1/login-alt.html">Login Alt</a></li>
                        <li><a href="http://lambdathemes.in/admin1/register.html">Register Form</a></li>
                        <li><a href="http://lambdathemes.in/admin1/register-alt.html">Register Alt</a></li>
                        <li><a href="http://lambdathemes.in/admin1/forgot.html">Forgot Password</a></li>
                        <li><a href="http://lambdathemes.in/admin1/lock-screen.html">Lock Screen</a></li>
                    </ul>
                </li>

            </ul>
        </div>
        <div class="slimScrollBar" style="width: 7px; position: absolute; top: 0px; opacity: 0.3; display: none; border-radius: 0px; z-index: 99; right: 0px; height: 1080px; background: rgb(204, 204, 204);"></div>
        <div class="slimScrollRail" style="width: 7px; height: 100%; position: absolute; top: 0px; display: none; border-radius: 0px; opacity: 0.2; z-index: 90; right: 0px; background: rgb(51, 51, 51);"></div>
    </div><!-- Page Sidebar Inner -->
</div>
@RenderBody()
</main><!-- Page Content -->
<nav class="cd-nav-container" id="cd-nav">
    <header>
        <h3>Navigation</h3>
        <a href="#" class="cd-close-nav">Close</a>
    </header>
    @using (Html.BeginForm("LogOff", "Account", FormMethod.Post, new {id = "logoutForm"}))
    {
        @Html.AntiForgeryToken()
        <ul class="cd-nav list-unstyled">
            <li class="cd-selected" data-menu="index">
                <a href="@Url.Action("Newsfeed", "Home")">
                    <span>
                            <i class="glyphicon glyphicon-home"></i>
                        </span>
                    <p>Home</p>
                </a>
            </li>
            <li data-menu="profile">
                <a href="@Url.Action(User.Identity.Name, "Profile")">
                    <span>
                            <i class="glyphicon glyphicon-user"></i>
                        </span>
                    <p>Profile</p>
                </a>
            </li>
            <li data-menu="inbox">
                <a href="javsacript:void(0);">
                    <span>
                            <i class="glyphicon glyphicon-envelope"></i>
                        </span>
                    <p>Mailbox</p>
                </a>
            </li>
            <li data-menu="#">
                <a href="javsacript:void(0);">
                    <span>
                            <i class="glyphicon glyphicon-tasks"></i>
                        </span>
                    <p>Tasks</p>
                </a>
            </li>
            <li data-menu="#">
                <a href="javsacript:void(0);">
                    <span>
                            <i class="glyphicon glyphicon-cog"></i>
                        </span>
                    <p>Settings</p>
                </a>
            </li>
            <li data-menu="#">
                <a href="javascript:document.getElementById('logoutForm').submit()" class="log-out">
                    <span>
                            <i class="fa fa-sign-out m-r-xs"></i>
                        </span>
                    <p>Log Off</p>
                </a>
            </li>
        </ul>
    }
</nav>
<div class="cd-overlay"></div>

    <!-- Modal -->
    <div id="msgModal" class="modal fade" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" onclick="new function () { location.reload(); }">&times;</button>
                    <h4 class="modal-title">Message</h4>
                </div>
                <div class="modal-body" id="contentModal"> 
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal" onclick="closeMsg()">Close</button>
                </div>
            </div>

        </div>
    </div>

    <!-- Modal -->
    <div id="msgConfirmModal" class="modal fade" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Message</h4>
                </div>
                <div class="modal-body" id="contentConfirmModal">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" id="btnConfirmYes" data-item-url="" data-item-id="" data-dismiss="modal" onclick="closeConfirmMsg(this)">Yes</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">No</button>
                </div>
            </div>

        </div>
    </div>

<!-- Javascripts -->
@RenderSection("scripts", required: false)


<div id="flotTip" style="display: none; position: absolute;"></div>
</body>
</html>
<script type="text/javascript">
    $(document).ready(function () {
        $('body').tooltip({
            selector: '[data-toggle="tooltip"]'
        });
        $("html").niceScroll({
            styler: "fb",
            cursorcolor: "#22baa0",
            cursorwidth: '6',
            cursorborderradius: '10px',
            background: '#F7F7F7',
            cursorborder: '',
            zindex: '600'
        });
        $(".slimscroll").niceScroll({
            styler: "fb",
            cursorcolor: "#22baa0",
            cursorwidth: '3',
            cursorborderradius: '10px',
            background: '#F7F7F7',
            cursorborder: '',
            zindex: '600'
        });
        $("#chat-box-content").niceScroll({
            styler: "fb",
            cursorcolor: "#22baa0",
            cursorwidth: '3',
            cursorborderradius: '10px',
            background: '#F7F7F7',
            cursorborder: '',
            zindex: '600'
        });

    });
</script>